- name: Build per-container app definition
  ansible.builtin.set_fact:
    app:
      name: "{{ service_name }}-{{ svc.name_suffix }}"
      repo: "{{ fastapi_repo_url }}"
      version: "{{ svc.version }}"
      ports:
        - "{{ svc.host_port }}:{{ container_internal_port }}"
      env_files: "{{ service_common.env_files }}"
      volumes: "{{ service_common.volumes }}"
      command: "{{ service_common.command }}"
      healthcheck:
        # container running check uses defaults anyway; set URL per container
        url: "http://localhost:{{ svc.host_port }}/health"
