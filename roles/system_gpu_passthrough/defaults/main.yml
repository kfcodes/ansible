---
# Toggleable VFIO design:
# - vfio_mode=host  => GPU used by Linux (amdgpu/snd_hda_intel)
# - vfio_mode=vfio  => GPU bound to vfio-pci at boot (for passthrough)
vfio_mode: "host" # "host" or "vfio"

# PCI IDs for passthrough GPU + its HDMI audio function.
# Format MUST be "dddd:dddd"
gpu_pci_ids:
  - "1002:67ef"
  - "1002:aae0"

# Optional BDFs, used for status output and (optional) emergency scripts.
gpu_bdf: []

# Platform IOMMU selection
iommu_platform: "intel" # "intel" or "amd"

# GRUB cmdline args that should ALWAYS be present (both host + vfio modes)
# IMPORTANT: keep this Intel-only for your system (prevents amd_iommu=on showing up).
grub_cmdline_always:
  - "iommu=pt"
  - "intel_iommu=on"

grub_cmdline_vfio_only:
  - "vfio-pci.ids={{ gpu_pci_ids | join(',') }}"
  - "rd.driver.pre=vfio-pci"
  - "modprobe.blacklist=amdgpu"

# Optional: reduce chance host grabs framebuffer early (useful in VFIO mode).
disable_efi_framebuffer: true

# Do NOT permanently blacklist drivers if you want to use GPU on Linux sometimes.
# If you enable this, it will only apply in VFIO mode.
blacklist_host_gpu_drivers: false

virtualization_packages:
  - qemu-system-x86
  - qemu-utils
  - ovmf
  - libvirt-daemon-system
  - libvirt-clients
  - virtinst
  - bridge-utils
  - cpu-checker
  - linux-firmware

# Optional VM creation (leave false if you already manage VM separately)
create_vm: false
vm_name: "win10"
vm_ram_mb: 8192
vm_vcpus: 4
vm_disk_path: "/var/lib/libvirt/images/win10.qcow2"
vm_disk_gb: 80
vm_iso_path: "/var/lib/libvirt/boot/windows.iso"

# Headless install access
vm_graphics: "spice" # "spice" or "vnc" or "none"
vm_graphics_listen: "127.0.0.1" # use SSH tunnel

# ----------------------------
# Demo VFIO VM (Alpine) - optional
# ----------------------------
create_demo_vm: true
demo_vm_name: "alpine-vfio"

# Alpine ISO
demo_iso_url: "https://dl-cdn.alpinelinux.org/alpine/v3.19/releases/x86_64/alpine-standard-3.19.1-x86_64.iso"
demo_iso_dir: "/var/lib/libvirt/boot"
demo_iso_filename: "alpine-standard-3.19.1-x86_64.iso"
demo_iso_path: "{{ demo_iso_dir }}/{{ demo_iso_filename }}"

# VM resources
demo_vm_ram_mb: 2048
demo_vm_vcpus: 2

# OVMF paths (Ubuntu)
ovmf_code_path: "/usr/share/OVMF/OVMF_CODE.fd"
ovmf_vars_template_path: "/usr/share/OVMF/OVMF_VARS.fd"
demo_nvram_path: "/var/lib/libvirt/qemu/nvram/{{ demo_vm_name }}_VARS.fd"

# Force passthrough GPU as primary VGA (often needed)
demo_enable_x_vga: true
